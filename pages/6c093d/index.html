<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Spring | notes</title>
    <meta name="generator" content="VuePress 1.9.5">
    
    <meta name="description" content="web前端技术博客,专注web前端学习与总结。JavaScript,js,ES6,TypeScript,vue,React,python,css3,html5,Node,git,github等技术文章。">
    <meta name="keywords" content="Java,Spring,SpringBoot,git,github,markdown">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/notes/assets/css/0.styles.b4ef3752.css" as="style"><link rel="preload" href="/notes/assets/js/app.6825a617.js" as="script"><link rel="preload" href="/notes/assets/js/2.e46b09ff.js" as="script"><link rel="preload" href="/notes/assets/js/15.28195839.js" as="script"><link rel="prefetch" href="/notes/assets/js/10.12484bc8.js"><link rel="prefetch" href="/notes/assets/js/11.6cd9c001.js"><link rel="prefetch" href="/notes/assets/js/12.ee16b483.js"><link rel="prefetch" href="/notes/assets/js/13.580082a0.js"><link rel="prefetch" href="/notes/assets/js/14.cfd02731.js"><link rel="prefetch" href="/notes/assets/js/16.4bde6841.js"><link rel="prefetch" href="/notes/assets/js/17.2e99d9cd.js"><link rel="prefetch" href="/notes/assets/js/18.768095ed.js"><link rel="prefetch" href="/notes/assets/js/19.5ecafde1.js"><link rel="prefetch" href="/notes/assets/js/20.e3557e3d.js"><link rel="prefetch" href="/notes/assets/js/21.0faf4690.js"><link rel="prefetch" href="/notes/assets/js/22.827f6bf4.js"><link rel="prefetch" href="/notes/assets/js/23.89121fe9.js"><link rel="prefetch" href="/notes/assets/js/24.d7ba0b27.js"><link rel="prefetch" href="/notes/assets/js/25.62e68202.js"><link rel="prefetch" href="/notes/assets/js/26.10f1803e.js"><link rel="prefetch" href="/notes/assets/js/27.ddfa9dec.js"><link rel="prefetch" href="/notes/assets/js/28.e848b7b0.js"><link rel="prefetch" href="/notes/assets/js/29.b3cb8a1f.js"><link rel="prefetch" href="/notes/assets/js/3.a69b7938.js"><link rel="prefetch" href="/notes/assets/js/30.3223f0e5.js"><link rel="prefetch" href="/notes/assets/js/31.762d1e17.js"><link rel="prefetch" href="/notes/assets/js/32.96165e76.js"><link rel="prefetch" href="/notes/assets/js/33.1d7efa1c.js"><link rel="prefetch" href="/notes/assets/js/34.929684a9.js"><link rel="prefetch" href="/notes/assets/js/35.e542a83f.js"><link rel="prefetch" href="/notes/assets/js/36.89b4fa4a.js"><link rel="prefetch" href="/notes/assets/js/37.c524ca44.js"><link rel="prefetch" href="/notes/assets/js/38.9459c8b3.js"><link rel="prefetch" href="/notes/assets/js/39.da7c15b5.js"><link rel="prefetch" href="/notes/assets/js/4.fb91bec8.js"><link rel="prefetch" href="/notes/assets/js/40.b85ff044.js"><link rel="prefetch" href="/notes/assets/js/41.b398f317.js"><link rel="prefetch" href="/notes/assets/js/42.7bca8f03.js"><link rel="prefetch" href="/notes/assets/js/43.ce9bed7c.js"><link rel="prefetch" href="/notes/assets/js/44.b5bb568e.js"><link rel="prefetch" href="/notes/assets/js/45.d6b9024f.js"><link rel="prefetch" href="/notes/assets/js/46.d672c877.js"><link rel="prefetch" href="/notes/assets/js/47.75443c1b.js"><link rel="prefetch" href="/notes/assets/js/48.69483f56.js"><link rel="prefetch" href="/notes/assets/js/49.939812ea.js"><link rel="prefetch" href="/notes/assets/js/5.702d3e9f.js"><link rel="prefetch" href="/notes/assets/js/50.55911bbf.js"><link rel="prefetch" href="/notes/assets/js/51.745735bf.js"><link rel="prefetch" href="/notes/assets/js/52.14c95bcd.js"><link rel="prefetch" href="/notes/assets/js/53.5361b8fb.js"><link rel="prefetch" href="/notes/assets/js/54.a6b56739.js"><link rel="prefetch" href="/notes/assets/js/55.fb47d51e.js"><link rel="prefetch" href="/notes/assets/js/56.e9c43b37.js"><link rel="prefetch" href="/notes/assets/js/57.4bb06b31.js"><link rel="prefetch" href="/notes/assets/js/58.4c0b7ef2.js"><link rel="prefetch" href="/notes/assets/js/59.00706c4c.js"><link rel="prefetch" href="/notes/assets/js/6.39aad29b.js"><link rel="prefetch" href="/notes/assets/js/7.ba69fa2e.js"><link rel="prefetch" href="/notes/assets/js/8.38b77b60.js"><link rel="prefetch" href="/notes/assets/js/9.5ed8a1c5.js">
    <link rel="stylesheet" href="/notes/assets/css/0.styles.b4ef3752.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/notes/" class="home-link router-link-active"><img src="/notes/img/logo.png" alt="notes" class="logo"> <span class="site-name can-hide">notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/notes/" class="nav-link">首页</a></div><div class="nav-item"><a href="/notes/Java/" class="nav-link">Java</a></div><div class="nav-item"><a href="/notes/Spring/" class="nav-link">Spring</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="SpringCloud" class="dropdown-title"><a href="/notes/SpringCloud/" class="link-title">SpringCloud</a> <span class="title" style="display:none;">SpringCloud</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notes/pages/6d3e7e/" class="nav-link">服务治理</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/notes/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notes/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/notes/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/notes/archives/" class="nav-link">归档</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/notes/" class="nav-link">首页</a></div><div class="nav-item"><a href="/notes/Java/" class="nav-link">Java</a></div><div class="nav-item"><a href="/notes/Spring/" class="nav-link">Spring</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="SpringCloud" class="dropdown-title"><a href="/notes/SpringCloud/" class="link-title">SpringCloud</a> <span class="title" style="display:none;">SpringCloud</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notes/pages/6d3e7e/" class="nav-link">服务治理</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/notes/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notes/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/notes/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/notes/archives/" class="nav-link">归档</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/notes/pages/6c093d/" aria-current="page" class="active sidebar-link">Spring</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/notes/pages/6c093d/#特性" class="sidebar-link">特性</a></li><li class="sidebar-sub-header level2"><a href="/notes/pages/6c093d/#事务的传播机制" class="sidebar-link">事务的传播机制</a></li><li class="sidebar-sub-header level2"><a href="/notes/pages/6c093d/#事务可能引发的问题" class="sidebar-link">事务可能引发的问题</a></li><li class="sidebar-sub-header level2"><a href="/notes/pages/6c093d/#隔离级别" class="sidebar-link">隔离级别</a></li><li class="sidebar-sub-header level2"><a href="/notes/pages/6c093d/#spring声明式事务配置" class="sidebar-link">Spring声明式事务配置</a></li><li class="sidebar-sub-header level2"><a href="/notes/pages/6c093d/#transactional失效" class="sidebar-link">@Transactional失效</a></li><li class="sidebar-sub-header level2"><a href="/notes/pages/6c093d/#同一个类中事务方法调用解决方法" class="sidebar-link">同一个类中事务方法调用解决方法</a></li></ul></li><li><a href="/notes/pages/9e7171/" class="sidebar-link">Spring</a></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-1baff76c><div class="articleInfo" data-v-1baff76c><ul class="breadcrumbs" data-v-1baff76c><li data-v-1baff76c><a href="/notes/" title="首页" class="iconfont icon-home router-link-active" data-v-1baff76c></a></li> <li data-v-1baff76c><a href="/notes/Spring/#Spring" data-v-1baff76c>Spring</a></li></ul> <div class="info" data-v-1baff76c><div title="作者" class="author iconfont icon-touxiang" data-v-1baff76c><a href="https://github.com/gevikhn" target="_blank" title="作者" class="beLink" data-v-1baff76c>nanami</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-1baff76c><a href="javascript:;" data-v-1baff76c>2021-12-12</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">Spring<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="spring事务"><a href="#spring事务" class="header-anchor">#</a> Spring事务</h1> <h2 id="特性"><a href="#特性" class="header-anchor">#</a> 特性</h2> <ul><li>原子性</li> <li>一致性</li> <li>隔离性</li> <li>持久性</li></ul> <h2 id="事务的传播机制"><a href="#事务的传播机制" class="header-anchor">#</a> 事务的传播机制</h2> <ul><li><p>REQUIRED:</p> <p>Spring默认的传播机制，能满足绝大部分业务需求，如果外层有事务，则当前事务加入到外层事务，一块提交，一块回滚。如果外层没有事务，新建一个事务执行</p></li> <li><p>REQUES_NEW:</p> <p>该事务传播机制是每次都会新开启一个事务，同时把外层事务挂起，当当前事务执行完毕，恢复上层事务的执行。如果外层没有事务，执行当前新开启的事务即可</p></li> <li><p>SUPPORT:</p> <p>如果外层有事务，则加入外层事务，如果外层没有事务，则直接使用非事务方式执行。完全依赖外层的事务</p></li> <li><p>NOT_SUPPORT</p> <p>该传播机制不支持事务，如果外层存在事务则挂起，执行完当前代码，则恢复外层事务，无论是否异常都不会回滚当前的代码</p></li> <li><p>NEVER</p> <p>该传播机制不支持外层事务，即如果外层有事务就抛出异常</p></li> <li><p>MANDATORY</p> <p>与NEVER相反，如果外层没有事务，则抛出异常</p></li> <li><p>NESTED</p> <p>该传播机制的特点是可以保存状态保存点，当前事务回滚到某一个点，从而避免所有的嵌套事务都回滚，即各自回滚各自的，如果子事务没有把异常吃掉，基本还是会引起全部回滚的。</p></li></ul> <h2 id="事务可能引发的问题"><a href="#事务可能引发的问题" class="header-anchor">#</a> 事务可能引发的问题</h2> <ul><li><p>脏读：</p> <p>脏读发生在一个事务读取了被另一个事务改写但尚未提交的数据时。如果这些改变在稍后被回滚了，那么第一个事务读取的数据就会是无效的。</p></li> <li><p>幻读：</p> <p>当一个事务（T1）读取几行记录后，另一个并发事务（T2）插入了一些记录时，幻读就发生了。在后来的查询中，第一个事务（T1）就会发现一些原来没有的额外记录。</p></li> <li><p>不可重复读：</p> <p>不可重复读发生在一个事务执行相同的查询两次或两次以上，但每次查询结果都不相同时。这通常是由于另一个并发事务在两次查询之间更新了数据。</p></li></ul> <h2 id="隔离级别"><a href="#隔离级别" class="header-anchor">#</a> 隔离级别</h2> <ul><li><p>读未提交</p> <p>允许读取尚未提交的更改。可能导致脏读、幻读或不可重复读。</p></li> <li><p>读提交</p> <p>允许从已经提交的并发事务读取。可防止脏读，但幻读和不可重复读仍可能会发生。</p></li> <li><p>可重复读</p> <p>对相同字段的多次读取的结果是一致的，除非数据被当前事务本身改变。可防止脏读和不可重复读，但幻读仍可能发生</p></li> <li><p>序列化</p> <p>完全服从ACID的隔离级别，确保不发生脏读、不可重复读和幻影读。这在所有隔离级别中也是最慢的，因为它通常是通过完全锁定当前事务所涉及的数据表来完成的。</p></li></ul> <h2 id="spring声明式事务配置"><a href="#spring声明式事务配置" class="header-anchor">#</a> Spring声明式事务配置</h2> <ol><li>事务的传播性：
@Transactional(propagation=Propagation.REQUIRED)</li> <li>事务的隔离级别：
@Transactional(isolation = Isolation.READ_UNCOMMITTED)</li></ol> <h2 id="transactional失效"><a href="#transactional失效" class="header-anchor">#</a> @Transactional失效</h2> <ul><li><p>异常被捕获
Spring中事务提交还是回滚是根据调用的方法是否抛出异常来决定的，因此如果把异常捕获之后又不抛出的话，即使出了问题，事务还是会提交。</p> <div class="language-Java extra-class"><pre class="language-java"><code>  <span class="token annotation punctuation">@Autowired</span>
  <span class="token keyword">private</span> <span class="token class-name">ClassB</span> b<span class="token punctuation">;</span>

  <span class="token annotation punctuation">@Autowired</span>
  <span class="token keyword">private</span> <span class="token class-name">ClassC</span> c<span class="token punctuation">;</span>

  <span class="token annotation punctuation">@Transactional</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">methodA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
          b<span class="token punctuation">.</span><span class="token function">methodB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          c<span class="token punctuation">.</span><span class="token function">methodC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div></li> <li><p>@Transactional修饰了非public方法
@Transactional只能用于 public 的方法上，否则事务不会失效，如果要用在非 public 方法上，可以开启AspectJ 代理模式。（默认代理模式CGlib）</p></li> <li><p>同一个类中的方法调用</p> <div class="language-Java extra-class"><pre class="language-java"><code>  <span class="token annotation punctuation">@Component</span>
  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span>
      <span class="token annotation punctuation">@Transactional</span>
      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">methodA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">methodB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      
      <span class="token annotation punctuation">@Transactional</span>
      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">methodB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// do something</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>methodB的事务是不生效的，因为这里是同一个类中的调用（更确切的说是同一个类同一个对象中），Spring事务的原理是调用时检查@Transactional注解，然后生成代理类进行事务管理，但是内部调用时不会生成代理类（或者说默认不会），因此也就无法进行事务管理。</p></li> <li><p>同一个类中, 一个未标注 @Transactional 的方法去调用标有 @Transactional 的方法, 事务会失效</p></li></ul> <h2 id="同一个类中事务方法调用解决方法"><a href="#同一个类中事务方法调用解决方法" class="header-anchor">#</a> 同一个类中事务方法调用解决方法</h2> <ul><li>方法拆分
这是一种最简单的方法，也就是把上面例子中的methodB拆分到一个单独的类里面，这样就是一般情况下的事务调用</li> <li>下面三种方法都是在methodB上添加@Transactional(propagation = Propagation.REQUIRES_NEW)之后进行的测试
<ul><li>使用AspectJ代理
具体操作就是，application.yml中需要配置spring.aop.auto ：true，然后在启动类开启AspectJ代理，并暴露代理类：@EnableAspectJAutoProxy(exposeProxy = true)
这样的话就可以在调用的时候获取到代理类，并进行方法调用：<div class="language-Java extra-class"><pre class="language-java"><code>    <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">TestClassA</span><span class="token punctuation">)</span><span class="token class-name">AopContext</span><span class="token punctuation">.</span><span class="token function">currentProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insertB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li>从ApplicationContext获取Bean
这个原理应该是和上面一样的，直从ApplicationContext中获取到当前Bean，然后再调用方法：<div class="language-Java extra-class"><pre class="language-java"><code><span class="token comment">// applicationContext 可以自动注入</span>
 applicationContext<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">TestClassA</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insertB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li>注入自身<div class="language-Java extra-class"><pre class="language-java"><code>  <span class="token annotation punctuation">@Component</span>
  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestClassA</span> <span class="token punctuation">{</span>
      <span class="token annotation punctuation">@Autowired</span>
      <span class="token keyword">private</span> <span class="token class-name">TestClassA</span> testClassA<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div>用这种方法也可以使methodB的事务生效，但是需要注意的是，第一次生成的代理类和自动注入的代理类不是一个对象，也就是代码中this和testClassA不是同一个对象，并且testclassA中不会再次自动注入。
所以如果methodB插入数据时需要当前对象的属性，这种方法便不能再使用</li></ul></li></ul></div></div> <!----> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/02/05, 17:38:25</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><!----> <a href="/notes/pages/9e7171/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Spring</div></a></div> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/notes/pages/9e7171/">Spring</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/notes/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/notes/pages/892142/"><div>
            controller
            <!----></div></a> <span class="date">04-25</span></dt></dl><dl><dd>02</dd> <dt><a href="/notes/pages/bb4118/"><div>
            pod
            <!----></div></a> <span class="date">04-25</span></dt></dl><dl><dd>03</dd> <dt><a href="/notes/pages/48d106/"><div>
            Service
            <!----></div></a> <span class="date">04-25</span></dt></dl> <dl><dd></dd> <dt><a href="/notes/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2021-2022
    <span>Evan Xu | <a href="https://github.com/xugaoyi/vuepress-theme-vdoing/blob/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/notes/assets/js/app.6825a617.js" defer></script><script src="/notes/assets/js/2.e46b09ff.js" defer></script><script src="/notes/assets/js/15.28195839.js" defer></script>
  </body>
</html>
