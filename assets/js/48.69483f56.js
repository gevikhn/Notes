(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{500:function(e,t,a){"use strict";a.r(t);var n=a(29),s=Object(n.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("p",[e._v("[toc]")]),e._v(" "),a("h1",{attrs:{id:"controller"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#controller"}},[e._v("#")]),e._v(" Controller")]),e._v(" "),a("ul",[a("li",[e._v("在集群上管理和运行容器的对象")]),e._v(" "),a("li",[e._v("pod是通过Controller来实现各种操作的，如弹性伸缩、滚动升级")]),e._v(" "),a("li",[e._v("pod和Controller通过label来建立联系")]),e._v(" "),a("li")]),e._v(" "),a("h2",{attrs:{id:"deployment"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#deployment"}},[e._v("#")]),e._v(" deployment")]),e._v(" "),a("ul",[a("li",[e._v("部署无状态应用")]),e._v(" "),a("li",[e._v("管理pod和Replicaset副本")]),e._v(" "),a("li",[e._v("部署，滚动升级等功能")]),e._v(" "),a("li",[e._v("常用于部署web服务/微服务")])]),e._v(" "),a("h4",{attrs:{id:"创建deployment"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建deployment"}},[e._v("#")]),e._v(" 创建deployment")]),e._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" apps/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" Deployment\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("deployment\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" nginx\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("matchLabels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" nginx\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("template")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" nginx\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" nginx\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("1.14.2\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("containerPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("80")]),e._v("\n\n")])])]),a("ul",[a("li",[a("p",[e._v("该配置文件将创建一个叫"),a("code",[e._v("nginx-deployment")]),e._v("的deployment，并由deployment创建3个Pod副本（由 "),a("code",[e._v("replicas")]),e._v(" 字段标明）")])]),e._v(" "),a("li",[a("p",[a("code",[e._v("selector")]),e._v(" 字段定义 Deployment 如何查找要管理的 Pods")])]),e._v(" "),a("li",[a("p",[a("code",[e._v("template")]),e._v(" 字段包含以下子字段：")]),e._v(" "),a("ul",[a("li",[e._v("Pod 被使用 "),a("code",[e._v(".metadata.labels")]),e._v(" 字段打上 "),a("code",[e._v("app: nginx")]),e._v(" 标签。")]),e._v(" "),a("li",[e._v("Pod 模板规约（即 "),a("code",[e._v(".template.spec")]),e._v(" 字段）指示 Pods 运行一个 "),a("code",[e._v("nginx")]),e._v(" 容器， 该容器运行版本为 1.14.2 的 "),a("code",[e._v("nginx")]),e._v(" "),a("a",{attrs:{href:"https://hub.docker.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker Hub"),a("OutboundLink")],1),e._v("镜像。")]),e._v(" "),a("li",[e._v("创建一个容器并使用 "),a("code",[e._v(".spec.template.spec.containers[0].name")]),e._v(" 字段将其命名为 "),a("code",[e._v("nginx")])])])])]),e._v(" "),a("ol",[a("li",[e._v("通过以下命令创建deployment")])]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl apply -f nginx-deployment.yml\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[e._v("运行 "),a("code",[e._v("kubectl get deployments")]),e._v(" 检查 Deployment 是否已创建")])]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl get deployments\nNAME               READY   UP-TO-DATE   AVAILABLE   AGE\nnginx-deployment   "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("/3     "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("            "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("           1s\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[e._v("要查看 Deployment 上线状态，运行 "),a("code",[e._v("kubectl rollout status deployment/nginx-deployment")])])]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl rollout status deployment/nginx-deployment\nWaiting "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("for")]),e._v(" rollout to finish: "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v(" out of "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),e._v(" new replicas have been updated"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("..")]),e._v(".\ndeployment "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"nginx-deployment"')]),e._v(" successfully rolled out\n")])])]),a("ol",{attrs:{start:"4"}},[a("li",[e._v("几秒钟后再次运行 "),a("code",[e._v("kubectl get deployments")])])]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl get deployments\nNAME               READY   UP-TO-DATE   AVAILABLE   AGE\nnginx-deployment   "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),e._v("/3     "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),e._v("            "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),e._v("           18s\n")])])]),a("ol",{attrs:{start:"5"}},[a("li",[e._v("要查看 Deployment 创建的 ReplicaSet（"),a("code",[e._v("rs")]),e._v("），运行 "),a("code",[e._v("kubectl get rs")])])]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("NAME                          DESIRED   CURRENT   READY   AGE\nnginx-deployment-75675f5897   "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),e._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),e._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),e._v("       18s\n")])])]),a("ol",{attrs:{start:"6"}},[a("li",[e._v("要查看每个 Pod 自动生成的标签，运行 "),a("code",[e._v("kubectl get pods --show-labels")]),e._v("。")])]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl get pods --show-labels\nNAME                                READY     STATUS    RESTARTS   AGE       LABELS\nnginx-deployment-75675f5897-7ci7o   "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("/1       Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("          18s       "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("app")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("nginx,pod-template-hash"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("3123191453")]),e._v("\nnginx-deployment-75675f5897-kzszj   "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("/1       Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("          18s       "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("app")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("nginx,pod-template-hash"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("3123191453")]),e._v("\nnginx-deployment-75675f5897-qqcnn   "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("/1       Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("          18s       "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("app")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("nginx,pod-template-hash"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("3123191453")]),e._v("\n")])])]),a("h4",{attrs:{id:"更新deployment"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#更新deployment"}},[e._v("#")]),e._v(" 更新deployment")]),e._v(" "),a("blockquote",[a("p",[e._v("仅当 Deployment Pod 模板（即 "),a("code",[e._v(".spec.template")]),e._v("）发生改变时，例如模板的标签或容器镜像被更新， 才会触发 Deployment 上线。其他更新（如对 Deployment 执行扩缩容的操作）不会触发上线动作。")])]),e._v(" "),a("ol",[a("li",[a("p",[e._v("先更新 nginx Pod 以使用 "),a("code",[e._v("nginx:1.16.1")]),e._v(" 镜像，而不是 "),a("code",[e._v("nginx:1.14.2")]),e._v(" 镜像。")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("set")]),e._v(" image deployment.v1.apps/nginx-deployment "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("nginx")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("nginx:1.16.1\n")])])]),a("p",[e._v("等效于")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("set")]),e._v(" image deployment/nginx-deployment "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("nginx")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("nginx:1.16.1\n")])])]),a("p",[e._v("输出：")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("deployment/nginx-deployment image updated\n")])])])]),e._v(" "),a("li",[a("p",[e._v("查看上线状态，运行")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl rollout status deployment/nginx-deployment\n")])])]),a("p",[e._v("输出：")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("Waiting for rollout to finish: 2 out of 3 new replicas have been updated...\n")])])]),a("p",[e._v("或")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('deployment "nginx-deployment" successfully rolled out\n')])])])])]),e._v(" "),a("h4",{attrs:{id:"回滚deployment"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#回滚deployment"}},[e._v("#")]),e._v(" 回滚Deployment")]),e._v(" "),a("blockquote",[a("p",[e._v("当回滚到较早的修订版本时，只有 Deployment 的 Pod 模板部分会被回滚。")])]),e._v(" "),a("p",[e._v("因为出错导致上线进程停止，如设置nginx版本时，将nginx:1.16.1设置为nginx:1.161：")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("set")]),e._v(" image deployment/nginx-deployment "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("nginx")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("nginx:1.161 --record"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("true\n")])])]),a("p",[e._v("检查上线状态：")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl rollout status deployment/nginx-deployment\n")])])]),a("p",[e._v("输出：")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("Waiting for rollout to finish: 1 out of 3 new replicas have been updated...\n")])])]),a("p",[a("strong",[e._v("检查 Deployment 上线历史")])]),e._v(" "),a("ol",[a("li",[e._v("检查 Deployment 修订历史")])]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl rollout "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("history")]),e._v(" deployment/nginx-deployment\n")])])]),a("p",[e._v("输出：")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('deployments "nginx-deployment"\nREVISION    CHANGE-CAUSE\n1           kubectl apply --filename=https://k8s.io/examples/controllers/nginx-deployment.yaml\n2           kubectl set image deployment/nginx-deployment nginx=nginx:1.16.1\n3           kubectl set image deployment/nginx-deployment nginx=nginx:1.161\n')])])]),a("ol",{attrs:{start:"2"}},[a("li",[a("p",[e._v("查看修订历史的详细信息")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl rollout "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("history")]),e._v(" deployment/nginx-deployment --revision"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v("\n")])])])])]),e._v(" "),a("p",[e._v("**回滚到之前的修订版本 **")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("撤消当前上线并回滚到以前的修订版本")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl rollout undo deployment/nginx-deployment\n")])])]),a("p",[e._v("回滚到指定版本")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl rollout undo deployment/nginx-deployment --to-revision"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v("\n")])])]),a("p",[e._v("回滚命令详细信息："),a("a",{attrs:{href:"https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#rollout",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("kubectl rollout")]),a("OutboundLink")],1)])]),e._v(" "),a("li",[a("p",[e._v("检查回滚是否成功以及 Deployment 是否正在运行：")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl get deployment nginx-deployment\n")])])])]),e._v(" "),a("li",[a("p",[e._v("获取 Deployment 描述信息")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl describe deployment nginx-deployment\n")])])]),a("p",[e._v("输出：")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('Name:                   nginx-deployment\nNamespace:              default\nCreationTimestamp:      Sun, 02 Sep 2018 18:17:55 -0500\nLabels:                 app=nginx\nAnnotations:            deployment.kubernetes.io/revision=4\n                        kubernetes.io/change-cause=kubectl set image deployment/nginx-deployment nginx=nginx:1.16.1\nSelector:               app=nginx\nReplicas:               3 desired | 3 updated | 3 total | 3 available | 0 unavailable\nStrategyType:           RollingUpdate\nMinReadySeconds:        0\nRollingUpdateStrategy:  25% max unavailable, 25% max surge\nPod Template:\n  Labels:  app=nginx\n  Containers:\n   nginx:\n    Image:        nginx:1.16.1\n    Port:         80/TCP\n    Host Port:    0/TCP\n    Environment:  <none>\n    Mounts:       <none>\n  Volumes:        <none>\nConditions:\n  Type           Status  Reason\n  ----           ------  ------\n  Available      True    MinimumReplicasAvailable\n  Progressing    True    NewReplicaSetAvailable\nOldReplicaSets:  <none>\nNewReplicaSet:   nginx-deployment-c4747d96c (3/3 replicas created)\nEvents:\n  Type    Reason              Age   From                   Message\n  ----    ------              ----  ----                   -------\n  Normal  ScalingReplicaSet   12m   deployment-controller  Scaled up replica set nginx-deployment-75675f5897 to 3\n  Normal  ScalingReplicaSet   11m   deployment-controller  Scaled up replica set nginx-deployment-c4747d96c to 1\n  Normal  ScalingReplicaSet   11m   deployment-controller  Scaled down replica set nginx-deployment-75675f5897 to 2\n  Normal  ScalingReplicaSet   11m   deployment-controller  Scaled up replica set nginx-deployment-c4747d96c to 2\n  Normal  ScalingReplicaSet   11m   deployment-controller  Scaled down replica set nginx-deployment-75675f5897 to 1\n  Normal  ScalingReplicaSet   11m   deployment-controller  Scaled up replica set nginx-deployment-c4747d96c to 3\n  Normal  ScalingReplicaSet   11m   deployment-controller  Scaled down replica set nginx-deployment-75675f5897 to 0\n  Normal  ScalingReplicaSet   11m   deployment-controller  Scaled up replica set nginx-deployment-595696685f to 1\n  Normal  DeploymentRollback  15s   deployment-controller  Rolled back deployment "nginx-deployment" to revision 2\n  Normal  ScalingReplicaSet   15s   deployment-controller  Scaled down replica set nginx-deployment-595696685f to 0\n')])])])])]),e._v(" "),a("h4",{attrs:{id:"缩放deployment"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#缩放deployment"}},[e._v("#")]),e._v(" 缩放Deployment")]),e._v(" "),a("p",[e._v("执行")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl scale deployment/nginx-deployment --replicas"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("10")]),e._v("\n")])])]),a("p",[e._v("如果启用了Pod的水平自动缩放，可以为Deplyment设置自动缩放器，并基于现有 Pod 的 CPU 利用率选择要运行的 Pod 个数下限和上限。")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl autoscale deployment/nginx-deployment --min"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("10")]),e._v(" --max"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("15")]),e._v(" --cpu-percent"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("80")]),e._v("\n")])])]),a("p",[a("a",{attrs:{href:"https://kubernetes.io/zh/docs/concepts/workloads/controllers/deployment/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Deployment官方文档"),a("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=s.exports}}]);