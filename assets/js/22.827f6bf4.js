(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{474:function(t,s,a){"use strict";a.r(s);var r=a(29),e=Object(r.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("[TOC]")]),t._v(" "),a("h1",{attrs:{id:"zuul服务网关"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zuul服务网关"}},[t._v("#")]),t._v(" Zuul服务网关")]),t._v(" "),a("p",[t._v("构建服务网关\n在"),a("code",[t._v("pom.xml")]),t._v("中添加依赖")]),t._v(" "),a("div",{staticClass:"language-Java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cloud"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("groupId"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("cloud"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("starter"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("netflix"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("eureka"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("client"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("artifactId"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("dependency"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v(" https"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("mvnrepository"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("artifact"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cloud"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("spring"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("cloud"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("starter"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("netflix"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("zuul "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cloud"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("groupId"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("cloud"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("starter"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("netflix"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("zuul"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("artifactId"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("dependency"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),a("p",[t._v("在主类添加"),a("code",[t._v("@EnableZuulProxy")]),t._v("和"),a("code",[t._v("@EnableDiscoveryClient")]),t._v("注解")]),t._v(" "),a("div",{staticClass:"language-Java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@EnableZuulProxy")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@EnableDiscoveryClient")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@SpringBootApplication")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ApiGatewayApplication")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SpringApplication")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ApiGatewayApplication")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("添加配置文件"),a("code",[t._v("application.yml")])]),t._v(" "),a("div",{staticClass:"language-Java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("server"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n  port"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1111")]),t._v("\n\nspring"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n  application"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" api"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("gateway\neureka"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n  client"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    service"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("url"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n      defaultZone"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" http"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1001")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("eureka"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("\n\n\nmanagement"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n  endpoints"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    web"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n      exposure"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n        include"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*"')]),t._v("\n")])])]),a("p",[t._v("访问"),a("a",{attrs:{href:"http://localhost:1111/actuator/routes",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://localhost:1111/actuator/routes"),a("OutboundLink")],1),t._v("查看当前路由节点")]),t._v(" "),a("div",{staticClass:"language-JSON extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"/eureka-consumer/**"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"eureka-consumer"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"/eureka-client/**"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"eureka-client"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("访问"),a("a",{attrs:{href:"http://localhost:1111/eureka-consumer/consumer",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://localhost:1111/eureka-consumer/consumer"),a("OutboundLink")],1),t._v("可以像之前一样访问消费者接口")]),t._v(" "),a("h2",{attrs:{id:"路由配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#路由配置"}},[t._v("#")]),t._v(" 路由配置")]),t._v(" "),a("h3",{attrs:{id:"传统路由配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#传统路由配置"}},[t._v("#")]),t._v(" 传统路由配置")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("单实例配置：通过一组zuul.routes.<route>.path与zuul.routes.<route>.url参数对的方式配置")]),t._v(" "),a("div",{staticClass:"language-Java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"zuul.routes.user-service.path=/user-service/**"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"zuul.routes.user-service.url=http://localhost:8080/"')]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("多实例配置：通过一组zuul.routes.<route>.path与zuul.routes.<route>.serviceId参数对的方式配置")]),t._v(" "),a("div",{staticClass:"language-Java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("zuul"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("routes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("user"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("service"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\nzuul.routes.user-service.serviceId=user-service\n\nribbon.eureka.enabled=false\nuser-service.ribbon.listOfServers=http://localhost:8080/,http://localhost:8081/\n")])])])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("ribbon.eureka.enabled")]),t._v("：由于"),a("code",[t._v("zuul.routes.<route>.serviceId")]),t._v("指定的是服务名称，默认情况下Ribbon会根据服务发现机制来获取配置服务名对应的实例清单。但是，若没有整合类似Eureka之类的服务治理框架，需要将该参数设置为false，不然配置的"),a("code",[t._v("serviceId")]),t._v("是获取不到对应实例清单的。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("user-service.ribbon.listOfServers")]),t._v("：该参数内容与"),a("code",[t._v("zuul.routes.<route>.serviceId")]),t._v("的配置相对应，开头的"),a("code",[t._v("user-service")]),t._v("对应了"),a("code",[t._v("serviceId")]),t._v("的值，这两个参数的配置相当于在该应用内部手工维护了服务与实例的对应关系。")])])]),t._v(" "),a("h3",{attrs:{id:"服务路由配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务路由配置"}},[t._v("#")]),t._v(" 服务路由配置")]),t._v(" "),a("blockquote",[a("p",[t._v("Spring Cloud Zuul通过与Spring Cloud Eureka的整合，实现了对服务实例的自动化维护，所以在使用服务路由配置的时候，我们不需要向传统路由配置方式那样为serviceId去指定具体的服务实例地址，只需要通过一组"),a("code",[t._v("zuul.routes.<route>.path")]),t._v("与"),a("code",[t._v("zuul.routes.<route>.serviceId")]),t._v("参数对的方式配置即可")])]),t._v(" "),a("div",{staticClass:"language-Java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("zuul"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("routes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("user"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("service"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\nzuul.routes.user-service.serviceId=user-service\n")])])])]),a("p",[t._v("对于面向服务的路由配置，除了使用path与serviceId映射的配置方式之外，还有一种更简洁的配置方式："),a("code",[t._v("zuul.routes.<serviceId>=<path>")]),t._v("，其中"),a("code",[t._v("<serviceId>")]),t._v("用来指定路由的具体服务名，"),a("code",[t._v("<path>")]),t._v("用来配置匹配的请求表达式。")]),t._v(" "),a("div",{staticClass:"language-Java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("zuul"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("routes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("service"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("user"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("service"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n")])])])]),a("hr"),t._v(" "),a("h1",{attrs:{id:"gateway"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gateway"}},[t._v("#")]),t._v(" Gateway")])])}),[],!1,null,null,null);s.default=e.exports}}]);