---
title: 服务消费Feign
date: 2021-12-12 12:48:26
permalink: /pages/e27e3e/
categories:
  - SpringCloud
tags:
  - 
---
[TOC]

# OpenFeign

> Spring Cloud Feign是一套基于Netflix Feign实现的声明式服务调用客户端。它使得编写Web服务客户端变得更加简单。我们只需要通过创建接口并用注解来配置它既可完成对Web服务接口的绑定。它具备可插拔的注解支持，包括Feign注解、JAX-RS注解。它也支持可插拔的编码器和解码器。Spring Cloud Feign还扩展了对Spring MVC注解的支持，同时还整合了Ribbon和Eureka来提供均衡负载的HTTP客户端实现。

## openfeign

复制一份eureka-consumer工程，命名为eureka-consuner-feign
在`pom.xml`中添加依赖

``` pom.xml
    <!-- https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-openfeign -->
    <dependency>
        <groupId>org.springframework.cloud</groupId>
        <artifactId>spring-cloud-starter-openfeign</artifactId>
    </dependency>
```
修改主类，添加`@EnableFeignClients`注解开启扫描Feigin客户端的功能
``` Java
@EnableDiscoveryClient
@EnableFeignClients
@SpringBootApplication
public class EurekaConsumerFeignApplication {
    @Bean
    public RestTemplate restTemplate(){
        return new RestTemplate();
    }

    public static void main(String[] args) {
        SpringApplication.run(EurekaConsumerFeignApplication.class, args);
    }

}
```
创建Feign客户端接口
``` java
@FeignClient("eureka-client")
public interface DcClient {
    @GetMapping("/dc")
    String consumer();
}
```
修改Controller,通过Feign客户端来调用服务提供方的接口
``` Java
@RestController
public class DCController {

    @Autowired
    DcClient dcClient;

    @GetMapping("/consumer")
    public String dc(){
        return  dcClient.consumer();
    }
}
```

## `OpenFeign` 超时控制

配置文件中配置`ribbon` 的 `ReadTimeout` 与 `ConnectTimeout` 属性

``` yaml
ribbon:
  ReadTimeout: 5000
  ConnectTimeout: 5000
```



## `OpenFeign `日志增强

* 配置类

  ```java
  import feign.Logger;
  import org.springframework.context.annotation.Bean;
  import org.springframework.context.annotation.Configuration;
  
  @Configuration
  public class FeignConfig {
      @Bean
      Logger.Level feignLoggerLevel(){
          return Logger.Level.FULL;
      }
  }
  ```

* 配置文件

  ```yaml
  logging:
    level:
      com.nanami.order.Interface.PayClient: debug
  ```

  

  
